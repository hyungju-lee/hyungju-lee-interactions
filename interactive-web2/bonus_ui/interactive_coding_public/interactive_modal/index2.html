<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-compatible" content="chrome=1,IE=edge">
<title></title>
<link rel="stylesheet" type="text/css" href="./css/commom.css">
<style type="text/css">
	.wrap {max-width: 900px; margin:0 auto; background:#f1f1f1;}
	.sec01 {height: 3000px;}
	.open_modal {display: inline-block; padding:0 20px; height:45px; font-size:16px; color:#fff; line-height: 45px; background-color:#222;;}
</style>
</head>
<body>
<div class="wrap">
	<section class="sec01">
		<div class="btn_wrap">
			<a herf="javascript:void(0)" class="open_modal">
				모달 오픈 클릭
			</a>
		</div>
	</section>
	<section class="modal_wrap">
		<article class="modal_cnt">
			<div class="modal_header">
				<h3>SJ MODAL</h3>
			</div>
			<div class="modal_body">
				<strong>안녕하세요 모달입니다</strong>
				<p>
					브라우저별로 스크롤바 크기를 계산합니다. 일반모달, 애니메이션이 걸린 모달을 열고 닫을때 덜컹 거리지 않아요 :) <br>

				</p>
			</div>
			<a href="javascript:void(0)" class="close_btn">닫기</a>
		</article>
		<div class="modal_dim"></div>
	</section>
</div>
<style type="text/css">
/**
 * modal
 */
body.modal_in {overflow: hidden;}
.modal_wrap {display:none;position: absolute; left:0; top:0; z-index:100; width:100%; height:100%; }
.modal_wrap.active {display: block;}
.modal_wrap .modal_dim {position: absolute; left: 0; top: 0; z-index: 10; display: block; width:100%; height:100%; content:''; background:rgba(0,0,0,.5);}
.modal_wrap .modal_cnt {position:relative; top:80px; z-index:20; width: 650px; min-height:500px; padding:20px  20px 0 20px; margin:0 auto;; background: #fff; box-shadow: 0 4px 10px rgba(0,0,0,.5); -webkit-box-shadow: 0 4px 10px rgba(0,0,0,.5); border-radius: 4px;}
.modal_wrap .modal_cnt .close_btn {position: absolute; top:0; right:0; z-index:50; display: inline-block; width:50px; height:50px; background: url('./images/btn_colse.png') no-repeat 0 0; background-size: 100% 100%; text-indent:-99999px;}
.modal_wrap .modal_cnt .modal_header {padding-bottom:5px; border-bottom:1px solid #ddd; }
.modal_wrap .modal_cnt .modal_body {padding-top:20px;}
</style>
<script type="text/javascript">
	(function () {
		var modalWrap = document.querySelector(".modal_wrap");
		var modalOpenBtn = document.querySelector(".open_modal");
		var modalCloseBtn = document.querySelector(".close_btn");
		var dimmed = document.querySelector(".modal_dim");
		var closeModal = [modalCloseBtn, dimmed];

		var getScrollWidth = function () {
			var body = document.querySelector('body');
			var scrollDiv = document.createElement('div');
			scrollDiv.style.position = "absolute";
			scrollDiv.style.top = "-9999px";
			scrollDiv.style.overflow = "scroll";
			scrollDiv.style.width = "60px";
			scrollDiv.style.height = "60px";
			body.appendChild(scrollDiv);
			var scrollbarWidth = document.body.scrollHeight > innerHeight ? (scrollDiv.offsetWidth - scrollDiv.clientWidth) + "px" : 0 + "px";
			body.removeChild(scrollDiv);
			return scrollbarWidth;
		}

		var transitionEndFunc = function () {
			modalWrap.style.display = "";
			document.body.classList.remove("modal_in");
			document.body.style.paddingRight = "";
			modalWrap.style.opacity = "";
			modalWrap.style.transition = "";
			modalWrap.removeEventListener("transitionend", transitionEndFunc)
		}

		modalOpenBtn.addEventListener("click", function () {
			document.body.classList.add("modal_in");
			modalWrap.style.display = "block";
			modalWrap.style.opacity = 0;
			document.body.style.paddingRight = getScrollWidth();
			requestAnimationFrame(function () {
				requestAnimationFrame(function () {
					modalWrap.style.opacity = 1;
					modalWrap.style.transition = "all 0.3s";
				})
			})
		})

		closeModal.forEach(function (val, i) {
			val.addEventListener("click", function () {
				requestAnimationFrame(function () {
					modalWrap.style.opacity = 0;
				})
				modalWrap.addEventListener("transitionend", transitionEndFunc)
			})
		})
	})()
</script>
</body>
</html>





